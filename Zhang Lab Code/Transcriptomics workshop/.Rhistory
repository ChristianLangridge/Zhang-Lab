plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
PCA=prcomp(t(tpm), scale=F)
PCA=prcomp(t(tpm_gn), scale=F)
library('DESeq2')
conds=as.factor(metadata$condition)
res=data.frame(res)
res=results(dds,contrast=c('conds',cond1,cond2))
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count_gn)),colData=coldata,design=~conds)
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_gn = '/Users/christianlangridge/Desktop/tpm_gene 16.34.09.txt'
tpm_gene = read.csv(tpm_gn,sep='\t',stringsAsFactors = F,row.names = 1)
View(count_gene)
mgi_gene_names = rownames(count_gene)
write.table(mgi_gene_names,file='/Desktop/mgi_gene_names.txt',sep = '\t', na = '',row.names = F)
write.table(mgi_gene_names,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/mgi_gene_names.txt',sep = '\t', na = '',row.names = F)
library(biomaRt)
mouse_mgi <- mgi_gene_names
mouse <- useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")
mapping <- getLDS(
attributes = c("mgi_symbol", "ensembl_gene_id"),  # Get MGI symbol AND mouse ENSEMBL ID
filters = "mgi_symbol",
values = mouse_mgi,
mart = mouse,
attributesL = c("hgnc_symbol", "ensembl_gene_id"),  # Get human symbol AND human ENSEMBL ID
martL = human,
uniqueRows = TRUE
)
rlang::last_trace()
rlang::last_trace(drop = FALSE)
mouse <- useEnsembl(
biomart = "genes",
dataset = "mmusculus_gene_ensembl",
mirror = "useast"
)
human <- useEnsembl(
biomart = "genes",
dataset = "hsapiens_gene_ensembl",
mirror = "useast"
)
mapping <- getLDS(
attributes = c("mgi_symbol", "ensembl_gene_id"),
filters = "mgi_symbol",
values = mouse_mgi,
mart = mouse,
attributesL = c("hgnc_symbol", "ensembl_gene_id"),
martL = human,
uniqueRows = TRUE
)
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_gn = '/Users/christianlangridge/Desktop/tpm_gene 16.34.09.txt'
tpm_gene = read.csv(tpm_gn,sep='\t',stringsAsFactors = F,row.names = 1)
mgi_gene_names = rownames(count_gene)
write.table(mgi_gene_names,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/mgi_gene_names.txt',sep = '\t', na = '',row.names = F)
library(biomaRt)
# Define your mouse MGI gene symbols
mouse_mgi <- mgi_gene_names
mouse <- useEnsembl(
biomart = "genes",
dataset = "mmusculus_gene_ensembl",
mirror = "asia"
)
human <- useEnsembl(
biomart = "genes",
dataset = "hsapiens_gene_ensembl",
mirror = "asia"
)
# Now run your mapping
mapping <- getLDS(
attributes = c("mgi_symbol", "ensembl_gene_id"),
filters = "mgi_symbol",
values = mouse_mgi,
mart = mouse,
attributesL = c("hgnc_symbol", "ensembl_gene_id"),
martL = human,
uniqueRows = TRUE
)
rlang::last_trace()
rlang::last_trace()
rlang::last_trace(drop = FALSE)
library(org.Mm.eg.db)
library(AnnotationDbi)
library(org.Hs.eg.db)
library(org.Hs.eg.db)
library(org.Mm.eg.db)
BiocManager::install("org.Hs.eg.db")
convertMouseMGIToHuman_Local <- function(mgi_symbols) {
cat("=== Mouse MGI to Human Gene Symbol Conversion (Local Database) ===\n\n")
# Step 1: Convert MGI symbols to mouse ENSEMBL IDs
cat("Step 1: Converting MGI symbols to mouse ENSEMBL IDs...\n")
mouse_ensembl <- mapIds(
org.Mm.eg.db,
keys = mgi_symbols,
column = "ENSEMBL",
keytype = "MGI",
multiVals = "first"  # Take first match if multiple exist
)
# Identify unmapped genes
unmapped_step1 <- names(mouse_ensembl)[is.na(mouse_ensembl)]
mapped_step1 <- mouse_ensembl[!is.na(mouse_ensembl)]
cat("  ✓ Mapped:", length(mapped_step1), "/", length(mgi_symbols), "\n")
if (length(unmapped_step1) > 0) {
cat("  ✗ Unmapped:", paste(unmapped_step1, collapse = ", "), "\n")
}
if (length(mapped_step1) == 0) {
cat("ERROR: No genes mapped. Check MGI symbol format.\n")
return(NULL)
}
# Step 2: Get mouse gene symbols and ENSEMBL IDs together
cat("\nStep 2: Retrieving mouse gene information...\n")
mouse_symbols <- mapIds(
org.Mm.eg.db,
keys = names(mapped_step1),
column = "SYMBOL",
keytype = "ENSEMBL",
multiVals = "first"
)
# Step 3: Map mouse ENSEMBL to human ENSEMBL (via homolog conversion)
# Note: Local databases don't directly have orthologs, so we use a different approach
# Map mouse ENSEMBL → mouse Entrez → human Entrez → human ENSEMBL
cat("Step 3: Finding mouse Entrez IDs...\n")
mouse_entrez <- mapIds(
org.Mm.eg.db,
keys = names(mapped_step1),
column = "ENTREZID",
keytype = "ENSEMBL",
multiVals = "first"
)
cat("Step 4: This step requires orthologs which aren't in basic packages.\n")
cat("Using alternative approach: HomoloGene database via biomaRt on slower connection.\n\n")
# Create intermediate dataframe
intermediate_df <- data.frame(
mgi_symbol = names(mapped_step1),
mouse_ensembl_id = as.character(mapped_step1),
mouse_symbol = as.character(mouse_symbols),
mouse_entrez = as.character(mouse_entrez),
stringsAsFactors = FALSE
)
return(intermediate_df)
}
result <- convertMouseMGIToHuman_Local(mgi_gene_names)
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
mgi_gene_names = rownames(count_gene)
mgi_gene_names = mgi_gene_names[mgi_gene_names == ""] <- " "
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_gn = '/Users/christianlangridge/Desktop/tpm_gene 16.34.09.txt'
tpm_gene = read.csv(tpm_gn,sep='\t',stringsAsFactors = F,row.names = 1)
mgi_gene_names = rownames(count_gene)
mgi_gene_names = mgi_gene_names[mgi_gene_names == ""] <- " "
mgi_gene_names = rownames(count_gene)
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_gn = '/Users/christianlangridge/Desktop/tpm_gene 16.34.09.txt'
tpm_gene = read.csv(tpm_gn,sep='\t',stringsAsFactors = F,row.names = 1)
mgi_gene_names = rownames(count_gene)
x <- "a1~!@#$%^&*(){}_+:\"<>?,./;'[]-="
mgi_gene_names <- gsub("[[:punct:]]", "", x)
mgi_gene_names <- gsub('"','',mgi_gene_names)
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_gn = '/Users/christianlangridge/Desktop/tpm_gene 16.34.09.txt'
tpm_gene = read.csv(tpm_gn,sep='\t',stringsAsFactors = F,row.names = 1)
mgi_gene_names = rownames(count_gene)
head(mgi_gene_names)
mgi_gene_names <- gsub('"','',mgi_gene_names)
head(mgi_gene_names)
write.table(mgi_gene_names,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/mgi_gene_names.txt',sep = '\t', na = '',row.names = F)
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_gn = '/Users/christianlangridge/Desktop/tpm_gene 16.34.09.txt'
tpm_gene = read.csv(tpm_gn,sep='\t',stringsAsFactors = F,row.names = 1)
mgi_gene_names = rownames(count_gene)
mgi_gene_names <- gsub('"','',mgi_gene_names)
head(mgi_gene_names)
write.table(mgi_gene_names,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/mgi_gene_names.txt',sep = '\t', na = '',row.names = F)
mgi_standard <- mgi_gene_names[
!grepl('^\\d+[A-Z][A-Z0-9]*Rik', mgi_gene_names) &  # Remove Rik format
!grepl('\\.\\d+$', mgi_gene_names) &                   # Remove GenBank format (dots)
!grepl('^[A-Z]{2,}\\d+$', mgi_gene_names)              # Remove accession IDs like AA467197
]
writeLines(paste0('"', mgi_standard, '"'), 'mgi_standard_genes.txt')
head(mgi_standard)
mgi_standard <- mgi_gene_names[
!grepl('^\\d+[A-Z][A-Z0-9]*Rik', mgi_gene_names) &  # Remove Rik format
!grepl('\\.\\d+$', mgi_gene_names) &                   # Remove GenBank format (dots)
!grepl('^[A-Z]{2,}\\d+$', mgi_gene_names)              # Remove accession IDs like AA467197
]
writeLines(paste0('"', mgi_standard, '"'), 'mgi_standard_genes.txt')
mgi_standard = writeLines(paste0('"', mgi_standard, '"'), 'mgi_standard_genes.txt')
head(mgi_standard)
mgi_standard <- writeLines(paste0('"', mgi_standard, '"'), 'mgi_standard_genes.txt')
head(mgi_standard)
count_gn = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(count_gn,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_gn = '/Users/christianlangridge/Desktop/tpm_gene 16.34.09.txt'
tpm_gene = read.csv(tpm_gn,sep='\t',stringsAsFactors = F,row.names = 1)
mgi_gene_names = rownames(count_gene)
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults' # The directory that includes the extracted folders
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
View(mapping)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
View(count_gn)
View(count_gn)
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
PCA=prcomp(t(tpm), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
PCA=prcomp(t(tpm), scale=F)
PCA=prcomp(t(tpm_gn), scale=F)
PCA=prcomp(t(tpm_gn), scale=F)
View(tpm_gn)
tpm_gn$Gene.name <- NULL
count_gn$Gene.name <- NULL
count_gn$Gene.name <- NULL
tpm_gn$Gene.name <- NULL
PCA=prcomp(t(tpm_gn), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
par(mar = c(3.1, 3.4, 3.1, 0.9))
PCA=prcomp(t(tpm_gn), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults' # The directory that includes the extracted folders
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
count_gn$Gene.name <- NULL
tpm_gn$Gene.name <- NULL
#Perform PCA on samples
PCA=prcomp(t(tpm_gn), scale=T)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
library('DESeq2')
conds=as.factor(metadata$condition)
conds=as.factor(metadata$condition)
count_tr = data.frame()
tpm_tr = data.frame()
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
View(count_tr)
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
View(count_gn)
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt',sep = '\t', na = '',row.names = F)
View(count_gn)
count_gn$Gene.name <- NULL
tpm_gn$Gene.name <- NULL
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt',sep = '\t', na = '',row.names = F)
tpm_gene.txt' #adjust this based on your file location
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/metadata.txt'
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/metadata.txt'
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt'
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)]
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt',sep = '\t', na = '',row.names = F)
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/metadata.txt'
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt'
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)]
PCA=prcomp(t(tpm), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
PCA=prcomp(t(tpm), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/metadata.txt'
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt'
count = read.csv(count_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
library('DESeq2')
conds=as.factor(metadata$condition)
coldata <- data.frame(row.names=rownames(metadata),conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
dds <- DESeq(dds)
cond1 = 'MI_1D' #First Condition
cond2 = 'SHAM_1D' #Reference Condition
res=results(dds,contrast=c('conds',cond1,cond2))
res=data.frame(res)
cond3 = 'SHAM_3D'#2nd reference condition
res2=results(dds,contrast=c('conds',cond1,cond3))
res2=data.frame(res2)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_1D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
comparison_1D = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_1D.txt'
results_1D = read.csv(comparison_1D,sep='\t',stringsAsFactors = F,row.names = 1)
View(results_1D)
deseq_file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt',sep = '\t', na = '',row.names = F)
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/metadata.txt'
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt'
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)]
PCA=prcomp(t(tpm), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/metadata.txt'
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt'
count = read.csv(count_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
library('DESeq2')
conds=as.factor(metadata$condition)
coldata <- data.frame(row.names=rownames(metadata),conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
dds <- DESeq(dds)
cond1 = 'MI_1D' #First Condition
cond2 = 'SHAM_1D' #Reference Condition
res=results(dds,contrast=c('conds',cond1,cond2))
res=data.frame(res)
cond3 = 'SHAM_3D'#2nd reference condition
res2=results(dds,contrast=c('conds',cond1,cond3))
res2=data.frame(res2)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_1D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
comparison_1D = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_1D.txt'
results_1D = read.csv(comparison_1D,sep='\t',stringsAsFactors = F,row.names = 1)
deseq_file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
GSC='/path_to_downloaded/KEGG.gmt'
y=loadGSC(GSC)
GSC='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
View(y)
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
View(logFC)
View(pval)
