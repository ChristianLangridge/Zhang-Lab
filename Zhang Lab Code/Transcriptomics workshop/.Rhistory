for(i in list.dirs(result_dir,recursive=F)){
print('i')
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = 'output/abundance.tsv' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
biomart_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/output/abundance.tsv' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
biomart_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/output/abundance.tsv' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
Gene.name
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
print('i')
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/mart_export.txt' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop',sep = '\t', na = '',row.names = F)
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/count_gn.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
---------------------------
### Data exploration
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
---------------------------
### Data exploration
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt' #adjust this based on your file location
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
---------------------------
### Data exploration
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt' #adjust this based on your file location
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
setwd("~/Desktop/Zhang Lab/Transcriptomics workshop")
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
---------------------------
### Data exploration
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt' #adjust this based on your file location
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
---------------------------
### Data exploration
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt' #adjust this based on your file location
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
PCA=prcomp(t(tpm), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
---------------------------
### Differential gene expression analysis
install.packages("DESeq2")
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
---------------------------
### Differential gene expression analysis
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("DESeq2")
library('DESeq2')
conds=as.factor(metadata$condition)
coldata <- data.frame(row.names=rownames(metadata),conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
dds <- DESeq(dds)
coldata <- data.frame(row.names=rownames(metadata),conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
library('DESeq2')
conds=as.factor(metadata$condition)
coldata <- data.frame(row.names=rownames(metadata),conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
print(class(count))
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/count_gn.txt' #adjust this based on your file location
count = read.csv(count_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
library('DESeq2')
conds=as.factor(metadata$condition)
coldata <- data.frame(row.names=rownames(metadata),conds)
print(class(count))
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
dds <- DESeq(dds)
cond1 = 'MI_1D' #First Condition
cond2 = 'SHAM_1D' #Reference Condition
res=results(dds,contrast=c('conds',cond1,cond2))
res=data.frame(res)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
cond3 = 'MI_1D' #First Condition
cond4 = 'SHAM_1D' #Reference Condition
cond3 = 'MI_1D' #First Condition
cond4 = 'SHAM_3D' #Reference Condition
res1=results(dds,contrast=c('conds',cond3,cond4))
res1=data.frame(res1)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
head("~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt")
print("~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt")
head("~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt")
deseq_1D = read.table(file="~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt")
View(deseq_1D)
deseq_file = read.table(file="~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt")
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
deseq_file = '~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
---------------------------
### Functional analysis
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
library('piano')
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
library('piano')
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
library('gplots')
library('visNetwork')
library('RColorBrewer')
library('piano')
BiocManager::install("piano")
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
GSC='/path_to_downloaded/KEGG.gmt'
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/mart_export.txt' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/count_gn.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
---------------------------
### Data exploration
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt' #adjust this based on your file location
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt' #adjust this based on your file location
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
### PCA analysis
### PCA analysis shows that these samples are very different from one another, each carrying different transcript abundances.
PCA=prcomp(t(tpm), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
library('DESeq2')
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/count_gn.txt' #adjust this based on your file location
count = read.csv(count_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
conds=as.factor(metadata$condition)
coldata <- data.frame(row.names=rownames(metadata),conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
dds <- DESeq(dds)
cond1 = 'MI_1D' #First Condition
cond2 = 'SHAM_1D' #Reference Condition
res=results(dds,contrast=c('conds',cond1,cond2))
res=data.frame(res)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
cond3 = 'MI_1D' #First Condition
cond4 = 'SHAM_3D' #Reference Condition
res1=results(dds,contrast=c('conds',cond3,cond4))
res1=data.frame(res1)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
deseq_file = '~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt'
---------------------------
### Functional analysis
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
input_file=deseq[ ,c('log2FoldChange','pvalue')]
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
res_piano=GSAsummaryTable(gsaRes)
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
res_piano=GSAsummaryTable(gsaRes)
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
---------------------------
### Functional analysis
deseq_file = '~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt'
deseq_file = '~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
BiocManager::install("piano")
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
head(y)
View(deseq)
GSCtest = read.csv(GSC,sep='\t',stringsAsFactors = F,row.names = 1)
GSCtest = read.table(GSC,sep='\t',stringsAsFactors = F,row.names = 1)
read.gmt(GSC)
library('qusage')
BiocManager::install("qusage")
library('qusage')
read.gmt(GSC)
View(y)
intersect(rownames(deseq),y$gsc)
(head(rownames(deseq)))
(head(unlist(y$gsc)))
result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/mart_export.txt' #adjust this based on your file location
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/count_gn.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt',sep = '\t', na = '',row.names = F)
---------------------------
### Data exploration
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/tpm_gn.txt' #adjust this based on your file location
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
### PCA analysis
### PCA analysis shows that these samples are very different from one another, each carrying different transcript abundances.
PCA=prcomp(t(tpm), scale=F)
plot(PCA$x,pch = 15,col=c('blue','blue','red','red','lightgreen','lightgreen','black','black'))
---------------------------
### Differential gene expression analysis
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("DESeq2")
library('DESeq2')
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/count_gn.txt' #adjust this based on your file location
count = read.csv(count_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
conds=as.factor(metadata$condition)
coldata <- data.frame(row.names=rownames(metadata),conds)
dds <- DESeqDataSetFromMatrix(countData=round(as.matrix(count)),colData=coldata,design=~conds)
dds <- DESeq(dds)
cond1 = 'MI_1D' #First Condition
cond2 = 'SHAM_1D' #Reference Condition
res=results(dds,contrast=c('conds',cond1,cond2))
res=data.frame(res)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
cond3 = 'MI_1D' #First Condition
cond4 = 'SHAM_3D' #Reference Condition
res1=results(dds,contrast=c('conds',cond3,cond4))
res1=data.frame(res1)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
---------------------------
### Functional analysis
deseq_file = '~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
library(org.Mm.eg.db) # or org.Hs.eg.db as appropriate
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
deseq_file = '~/Desktop/Zhang Lab/Transcriptomics workshop/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
library(org.Mm.eg.db) # or org.Hs.eg.db as appropriate
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
library('qusage')
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
read.gmt(GSC)
y=loadGSC
(head(rownames(deseq)))
(head(unlist(y$gsc)))
(head(unlist(y$gsc)))
y=loadGSC
(head(unlist(y$gsc)))
(head(rownames(deseq)))
(head(unlist(y$gsc)))
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
intersect(rownames(deseq),y$gsc)
intersect(rownames(deseq),unlist(y$gsc))
BiocManager::install("org.Mm.eg.db")
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
GSC='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
### Looking at why the summary isn't being created.
intersect(rownames(deseq),unlist(y$gsc))
(head(rownames(deseq)))
(head(unlist(y$gsc)))
library('org.Mm.eg.db')
BiocManager::install("AnnotationDbi")
BiocManager::install("AnnotationDbi")
library('AnnotationDbi')
library('org.Mm.eg.db')
mapped_symbols <- mapIds(org.Mm.eg.db, keys = rownames(deseq),
column = "SYMBOL", keytype = "SYMBOL", multiVals="first")
rownames(deseq) <- toupper(rownames(deseq))
names(mapped_symbols) <- toupper(names(mapped_symbols))
intersect(rownames(deseq), unlist(y$gsc))
head(names(mapped_symbols))
rownames(deseq) <- symbols
# Remove everything after the dot
de.ids <- gsub("\\..*$", "", rownames(deseq))
library(org.Hs.eg.db) # or org.Mm.eg.db for mouse
# Remove everything after the dot
de.ids <- gsub("\\..*$", "", rownames(deseq))
library(org.Mm.eg.db)
symbols <- mapIds(org.Hs.eg.db,
keys = de.ids,
column = "SYMBOL",
keytype = "ENSEMBL",
multiVals = "first")
symbols <- mapIds(org.Hs.eg.db,
keys = de.ids,
column = "SYMBOL",
keytype = "ENSEMBL",
multiVals = "first")
library(org.Mm.eg.db)
symbols <- mapIds(org.Hs.eg.db,
keys = de.ids,
column = "SYMBOL",
keytype = "ENSEMBL",
multiVals = "first")
rownames(deseq) <- symbols
intersect(rownames(deseq), unlist(y$gsc))
