result_dir = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/KallistoResults' # The directory that includes the extracted folders
count_tr = data.frame()
biomart_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/output' #adjust this based on your file location
View(count_tr)
View(count_tr)
View(count_tr)
### Loading packages and data
library(tidyverse)
library(dplyr)
library(psych)      # For describe statistics
library(car)        # For VIF
library(corrplot)   # For correlation matrix plot
gene_expression  <- read_tsv("/Users/christianlangridge/Desktop/Zhang-Lab copy 2/Zhang Lab Data/Pocket data files/Geneexpression(pocket).tsv")
tf_expression <- read_tsv("/Users/christianlangridge/Desktop/Zhang-Lab copy 2/Zhang Lab Data/Pocket data files/TF(pocket).tsv")
### Loading packages and data
library(tidyverse)
library(dplyr)
library(psych)      # For describe statistics
library(car)        # For VIF
library(corrplot)   # For correlation matrix plot
gene_expression  <- read_tsv("/Users/christianlangridge/Desktop/Zhang-Lab copy 2/Zhang Lab Data/Pocket data files/Geneexpression(pocket).tsv")
tf_expression <- read_tsv("/Users/christianlangridge/Desktop/Zhang-Lab copy 2/Zhang Lab Data/Pocket data files/TF(pocket).tsv")
set.seed(123)
# Function to sample columns representative for analysis
sample_columns <- function(df, sample_size = 20) {
numeric_cols <- sapply(df, is.numeric)
numeric_colnames <- names(df)[numeric_cols]
n <- min(sample_size, length(numeric_colnames)) # If sample_size larger than available numeric columns, use all
sampled_cols <- sample(numeric_colnames, n) # Randomly sample column names
return(df[, sampled_cols, drop = FALSE])
}
# Sample columns from each large dataset
gene_expression_sample <- sample_columns(gene_expression, sample_size = 20)
tf_expression_sample <- sample_columns(tf_expression, sample_size = 20)
View(tf_expression_sample)
print("Summary Statistics for gene_expression_sample:")
print(describe(gene_expression_sample))    # Includes mean, sd, skewness, kurtosis
print("Variance of columns in gene_expression_sample:")
print(sapply(gene_expression_sample, var))
print("Summary Statistics for tf_expression_sample:")
print(describe(tf_expression_sample))
print("Summary Statistics for gene_expression_sample:")
print(describe(gene_expression_sample))    # Includes mean, sd, skewness, kurtosis
print("Variance of columns in gene_expression_sample:")
print(sapply(gene_expression_sample, var))
print("Summary Statistics for tf_expression_sample:")
print(describe(tf_expression_sample))
print("Variance of columns in tf_expression_sample:")
print(sapply(tf_expression_sample, var))
### Making a correlation matrix for both files
print("Correlation matrix for gene_expression_sample:")
cor_gene_expression_sample <- cor(gene_expression_sample, use="complete.obs")
print(cor_gene_expression_sample)
corrplot(cor_gene_expression_sample, method="color")
print("Correlation matrix for tf_expression_sample:")
cor_tf_expression_sample <- cor(tf_expression_sample, use="complete.obs")
print(cor_tf_expression_sample)
corrplot(cor_tf_expression_sample, method="color")
if (ncol(df1) > 1) {
model1 <- lm(df1[[1]] ~ ., data = df1)
print("VIF values df1:")
print(vif(model1))
}
if (ncol(gene_expression_sample) > 1) {
model1 <- lm(gene_expression_sample[[1]] ~ ., data = gene_expression_sample)
print("VIF values gene_expression_sample:")
print(vif(gene_expression_sample))
}
class(gene_expression_sample)
class(tf_expression_sample)
gene_expression_sample <- as.data.frame(gene_expression_sample)
tf_expression_sample <- as.data.frame(tf_expression_sample)
if (ncol(gene_expression_sample) > 1) {
model1 <- lm(gene_expression_sample[[1]] ~ ., data = gene_expression_sample)
print("VIF values gene_expression_sample:")
print(vif(gene_expression_sample))
}
if (ncol(tf_expression_sample) > 1) {
model2 <- lm(tf_expression_sample[[1]] ~ ., data = tf_expression_sample)
print("VIF values tf_expression_sample:")
print(vif(model2))
}
if (ncol(gene_expression_sample) > 1) {
model1 <- lm(gene_expression_sample[[1]] ~ ., data = gene_expression_sample)
print("VIF values gene_expression_sample:")
print(vif(gene_expression_sample))
}
if (ncol(tf_expression_sample) > 1) {
model2 <- lm(tf_expression_sample[[1]] ~ ., data = tf_expression_sample)
print("VIF values tf_expression_sample:")
print(vif(model2))
}
View(gene_expression_sample)
tf_expression_sample <- as.data.frame(tf_expression_sample)
gene_expression_sample <- as.data.frame(gene_expression_sample)
tf_expression_sample <- as.data.frame(tf_expression_sample)
if (ncol(gene_expression_sample) > 1) {
model1 <- lm(gene_expression_sample[[1]] ~ ., data = gene_expression_sample)
print("VIF values gene_expression_sample:")
print(vif(gene_expression_sample))
}
if (ncol(tf_expression_sample) > 1) {
model2 <- lm(tf_expression_sample[[1]] ~ ., data = tf_expression_sample)
print("VIF values tf_expression_sample:")
print(vif(model2))
}
if (ncol(gene_expression_sample) > 1) {
model1 <- lm(gene_expression_sample[[1]] ~ ., data = gene_expression_sample)
print("VIF values gene_expression_sample:")
print(vif(model1))
}
ensembl_ids <- mapIds(
org.Mm.eg.db,
keys = gene_symbols,
column = "ENSEMBL",
keytype = "SYMBOL",
multiVals = "first"
)
deseq_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
library('org.Mm.eg.db')
library('AnnotationDbi')
GSC='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
input_file=deseq[ ,c('log2FoldChange','pvalue')]
logFC=as.matrix(input_file[,1])
pval=as.matrix(input_file[,2])
rownames(logFC)=toupper(rownames(input_file))
rownames(pval)=toupper(rownames(input_file))
logFC[is.na(logFC)] <- 0
pval[is.na(pval)] <- 1
gsaRes <- runGSA(pval,logFC,gsc=y, geneSetStat="reporter", signifMethod="nullDist", nPerm=1000)
intersect(rownames(deseq),unlist(y$gsc))
(head(rownames(deseq)))
(head(unlist(y$gsc)))
ensembl_ids <- mapIds(
org.Mm.eg.db,
keys = gene_symbols,
column = "ENSEMBL",
keytype = "SYMBOL",
multiVals = "first"
)
rownames(deseq) <- ensembl_ids
ensembl_ids <- mapIds(
org.Mm.eg.db,
keys = gene_symbols,
column = "ENSEMBL",
keytype = "SYMBOL",
multiVals = "first"
)
ensembl_ids <- mapIds(org.Mm.eg.db,
keys = gene_symbols,     # gene_symbols is your vector of symbols
column = "ENSEMBL",
keytype = "SYMBOL",
multiVals = "first")
gene_symbols <- rownames(deseq)
ensembl_ids <- mapIds(org.Mm.eg.db,
keys = gene_symbols,     # gene_symbols is your vector of symbols
column = "ENSEMBL",
keytype = "SYMBOL",
multiVals = "first")
rownames(deseq) <- ensembl_ids
View(deseq)
valid_symbols <- symbols[symbols %in% keys(org.Mm.eg.db, keytype = "SYMBOL")]
valid_symbols <- symbols[symbols %in% keys(org.Mm.eg.db, keytype = "SYMBOL")]
# Get all valid symbols from org.Mm.eg.db
valid_keys <- keys(org.Mm.eg.db, keytype = "SYMBOL")
# Function to filter each character vector
filter_valid_symbols <- function(symbols) {
symbols[symbols %in% valid_keys]
}
# Apply over the gene set list
filtered_gsc <- lapply(y$gsc, filter_valid_symbols)
View(y)
filtered_gsc <- lapply(y$gsc, filter_valid_symbols)
View(filtered_gsc)
GSC='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/KEGG.gmt'
y=loadGSC(GSC)
View(y)
write.table(res,file='/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/deseq_3D.txt',sep = '\t', na = '',row.names = T,col.names=NA)
---------------------------
### Functional analysis
deseq_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/deseq_1D.txt'
deseq_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/deseq_1D.txt'
deseq = read.csv(deseq_file,sep='\t',stringsAsFactors = F,row.names = 1)
View(deseq)
library('piano')
library('Biobase')
library('snow')
library('RColorBrewer')
library('gplots')
library('visNetwork')
library('org.Mm.eg.db')
library('AnnotationDbi')
library('DESeq2')
metadata_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/metadata.txt' #adjust this based on your file location
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/metadata.txt'
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_file = '/Users/christianlangridge/Desktop/Zhang Lab/Transcriptomics workshop/count_gn.txt' #adjust this based on your file location
View(metadata)
count = read.csv(count_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
count_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/count_gn.txt' #adjust this based on your file location
count = read.csv(count_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)] # make sure that sequence of metadata is the same with tpm
View(count)
file = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(file,sep='\t',stringsAsFactors = F,row.names = 1)
View(count_gene)
file = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(file,sep='\t',stringsAsFactors = F,row.names = 1)
write.table(rownames(count_gene),file='//Users/christianlangridge/Desktop/test/count_gene.txt',sep = '\t', na = '',row.names = F)
library(biomaRt)
# Define mouse and human marts
mouse_mart <- useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human_mart <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")
View(count_gene)
riken_ids <- rownames(count_gene)
mouse_symbols <- getBM(attributes = c("riken_cDNA", "mgi_symbol"),
filters = "riken_cDNA",
values = riken_ids,
mart = mouse_mart)
mouse_data <- getBM(attributes = c('external_gene_name', 'ensembl_gene_id', 'mgi_symbol'),
filters = 'external_gene_name',
values = riken_ids,
mart = mouse_mart)
mouse_genes <- mouse_symbols$mgi_symbol
mouse_symbols <- mouse_data$mgi_symbol
mouse_genes <- mouse_symbols$mgi_symbol
file = '/Users/christianlangridge/Desktop/count_gene 16.34.09.txt'
count_gene = read.csv(file,sep='\t',stringsAsFactors = F,row.names = 1)
library(biomaRt)
# Define mouse and human marts
mouse_mart <- useMart("ensembl", dataset = "mmusculus_gene_ensembl")
human_mart <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")
# Your vector of mouse Riken IDs
riken_ids <- c("0610009B22Rik", "0610007P14Rik")
# Map Riken IDs to Ensembl gene IDs and MGI symbols
mouse_data <- getBM(attributes = c('external_gene_name', 'ensembl_gene_id', 'mgi_symbol'),
filters = 'external_gene_name',
values = riken_ids,
mart = mouse_mart)
# Extract mouse gene symbols for orthology mapping
mouse_symbols <- mouse_data$mgi_symbol
# Map mouse genes to human orthologs
human_genes <- getLDS(attributes = c("mgi_symbol"),
filters = "mgi_symbol",
values = mouse_symbols,
mart = mouse_mart,
attributesL = c("hgnc_symbol"),
martL = human_mart,
uniqueRows = TRUE)
rlang::last_trace()
mouse_symbols <- mouse_data$mgi_symbol
View(mouse_data)
setwd("~/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop")
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults2'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rm(list=ls())
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults2'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt',sep = '\t', na = '',row.names = F)
write.table(count_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/count_gene.txt',sep = '\t', na = '',row.names = F)
write.table(tpm_gn,file='/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt',sep = '\t', na = '',row.names = F)
metadata_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/metadata.txt'
metadata = read.csv(metadata_file,sep='\t',stringsAsFactors = F,row.names = 1)
tpm_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt'
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)]
tpm_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/tpm_gene.txt'
tpm = read.csv(tpm_file,sep='\t',stringsAsFactors = F,row.names = 1)[,rownames(metadata)]
View(metadata)
rownames(metadata)
rm(list=ls())
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults2'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
result_dir = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Results/KallistoResults2'
count_tr = data.frame()
tpm_tr = data.frame()
for(i in list.dirs(result_dir,recursive=F)){
temp = read.csv(paste0(i,'/abundance.tsv'),sep='\t',stringsAsFactors = F)
temp_count = data.frame(temp$est_counts)
temp_tpm = data.frame(temp$tpm)
colnames(temp_count) = gsub(paste0(result_dir,"/"), "", i)
colnames(temp_tpm) = gsub(paste0(result_dir,"/"), "", i)
if(ncol(count_tr) == 0){
count_tr = temp_count
rownames(count_tr) = temp$target_id
tpm_tr = temp_tpm
rownames(tpm_tr) = temp$target_id
} else {
count_tr = cbind(count_tr, temp_count)
tpm_tr = cbind(tpm_tr,temp_tpm)
}
}
biomart_file = '/Users/christianlangridge/Desktop/Zhang-Lab/Zhang Lab Code/Transcriptomics workshop/Data/mart_export.txt'
mapping = read.csv(biomart_file,sep='\t',stringsAsFactors = F,row.names = 1)
count_gn = merge(count_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
count_gn = count_gn[,2:ncol(count_gn)]
count_gn = aggregate(.~Gene.name, count_gn, sum)
rownames(count_gn) = count_gn$Gene.name
tpm_gn = merge(tpm_tr,mapping['Gene.name'], by=0,all=F) # merge only for the shared row names
tpm_gn = tpm_gn[,2:ncol(tpm_gn)]
tpm_gn = aggregate(.~Gene.name, tpm_gn, sum)
rownames(tpm_gn) = tpm_gn$Gene.name
